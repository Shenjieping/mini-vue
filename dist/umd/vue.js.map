{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/html-parser.js","../../src/compiler/codegen.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["/**\n * @param {any} obj 需要判断的对象\n * @returns {boolean}\n */\nexport function isObject(obj) {\n  return obj && typeof obj === 'object';\n}\n\n/**\n * 给某个对象设置私有属性\n * @param {Object} obj 需要添加的对象\n * @param {string} key 属性\n * @param {any} val 值\n * @param {boolean} enumerable 是否可枚举\n */\nexport function def (obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: true,\n    configurable: true\n  })\n}\n\n/**\n * \n * @param {object} vm 代理的对象\n * @param {string} source \n * @param {string} key 代理的属性\n */\nexport function proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key];\n    },\n    set(newValue) {\n      vm[source][key] = newValue;\n    }\n  })\n}","/* \n  我们要对数组的 7 个方法进行重写：\n    push, pop, shift, unshift, reverse, sort, splice\n  因为这7个方法会改变原数组\n */\n\nconst arrayProto = Array.prototype;\n// 原型链查找，会向上查找，先查找我们重写的，如果没有再向上查找原型链上的\nexport const arrayMethods = Object.create(arrayProto); // 拷贝原型上的方法，防止我们的代码破坏了原型链\n\nconst methodsToPatch = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n];\n\nmethodsToPatch.forEach(method => {\n  arrayMethods[method] = function(...args) {\n    // 调用我们的方法后。又去调用了原生的方法\n    const result = arrayProto[method].apply(this, args);\n    let ob = this.__ob__; // 将实例上的方法传过来\n    // push shift splice 添加的值可能还是一个对象\n    let inserted; // 保存当前用户插入的元素\n    switch (method) {\n      case 'push':\n      case 'shift':\n        inserted = args;\n        break;\n      case 'splice':\n        // splice有3个属性，只有最后一个属性才是新增的值\n        inserted = args.slice(2);\n        break;\n    }\n    if (inserted) {\n      // 将新增的属性继续观察\n      ob.observerArray(inserted);\n    }\n    return result;\n  }\n});\n","import { isObject, def } from \"../util/index\";\nimport { arrayMethods } from './array';\n\nclass Observer {\n  constructor(value) {\n    this.value = value;\n    // 给当前值，添加一个不可枚举的私有属性，并于传值\n    def(value, '__ob__', this); // 这里如果不设置为不可枚举的值，会导致死循环\n    if (Array.isArray(value)) {\n      // 如果是数组的话。并不会对索引进行观察。因为会导致性能问题\n      // 如果数组里放的是对象。我再对里面的对象进行监控\n      this.observerArray(value);\n      // 我们还需要对 push pop shift unshift splice reverse sort 进行重写\n      value.__proto__ = arrayMethods;\n      /* \n        源码这里做了一个兼容处理，因为IE老浏览器是不支持 __proto__ 设置原型链\n        咋们这里为了简化，不做处理\n       */\n    } else {\n      // 如果是对象，则进行下一步\n      this.walk(value);\n    }\n  }\n  walk(obj) {\n    let keys = Object.keys(obj);\n    // 循环每一个key，添加get/set\n    for (let i = 0; i < keys.length; i++) {\n      let key = keys[i];\n      let value = obj[key];\n      defineReactive(obj, key, value); // 定义响应式数据\n    }\n  }\n  observerArray (items) {\n    for (let i = 0; i < items.length; i++) {\n      observe(items[i]);\n    }\n  }\n}\n\nexport function defineReactive(obj, key, value) {\n  // 递归设置嵌套的对象\n  observe(value);\n  Object.defineProperty(obj, key, {\n    get() {\n      return value;\n    },\n    set(newValue) { // 设置值的时候做一些操作\n      if (value === newValue) {\n        return;\n      }\n      console.log('update 视图更新');\n      observe(newValue); // 如果新设置的值是一个对象，也要被监控\n      value = newValue;\n    }\n  });\n\n  /* \n    通过Vue源码可以看出，data还可以设置 get/set属性\n      如果设置了get，需要先执行函数，拿到返回值再进行处理。为了简化，这里不做这一层的处理\n   */\n}\n\n// 用于观测数据，给每个属性添加 get 和 set 方法\nexport function observe(value) {\n  if (!isObject(value)) {\n    return;\n  }\n  return new Observer(value);\n}","import { observe } from \"./observer/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  // Vue 的数据来源\n  if (opts.props) {\n    initProps(vm);\n  }\n  if (opts.methods) {\n    initMethods(vm);\n  }\n  if (opts.data) {\n    initData(vm);\n  }\n  if (opts.computed) {\n    initComputed(vm);\n  }\n  if (opts.watch) {\n    initWatch(vm);\n  }\n}\n\nfunction initProps(vm) {\n  \n}\nfunction initMethods(vm) {\n  \n}\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key];\n    },\n    set(newValue) {\n      vm[source][key] = newValue;\n    }\n  })\n}\nfunction initData(vm) {\n  // 数据初始化\n  let data = vm.$options.data;\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data;\n  // 对象劫持，用户改变了数据，我希望能检测到，从而更新页面\n  // MVVM 数据变化可以驱动视图\n\n  // 为了让用户更好的使用，需要将属性直接代理到 vm 上\n  for (let key in vm._data) {\n    proxy(vm, '_data', key);\n  }\n\n  // 通过Object.defineProperty 给属性增加get和set方法\n  observe(data); // 响应式原理\n}\nfunction initComputed(vm) {\n  \n}\nfunction initWatch(vm) {\n  \n}","// 字母a-zA-Z_ - . 数组小写字母 大写字母\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名\n// ?:匹配不捕获   <aaa:aaa>\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\n// startTagOpen 可以匹配到开始标签 正则捕获到的内容是 (标签名)\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\n// 闭合标签 </xxxxxxx>\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\n// <div aa   =   \"123\"  bb=123  cc='123'\n// 捕获到的是 属性名 和 属性值 arguments[1] || arguments[2] || arguments[2]\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\n// <div >   <br/>\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\n// 匹配动态变量的  +? 尽可能少匹配\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\n\nexport function parseHTML(html) {\n  let root; // 根节点\n  let stack = []; // 判断是否是闭合标签\n  let currentParent; // 用来标识当前元素的父节点\n  const ELEMENT_TYPE = 1; // 元素节点\n  const TEXT_TYPE = 3; // 文本节点\n\n  // 不停的去解析html字符串\n  while (html) {\n    let textEnd = html.indexOf('<'); // 从html < 开始匹配\n    if (textEnd === 0) {\n      // 如果当前索引为0,肯定是一个标签，可能是开始标签，也可能是结束标签，第一次肯定是开始标签\n      let startTagMatch = parseStartTag(); // 通过此方法获取到匹配的结果 tagName attrs\n      if (startTagMatch) {\n        start(startTagMatch.tagName, startTagMatch.attrs);\n        continue; // 如果开始标签匹配完之后，继续下一次匹配\n      }\n      let endTagMatch = html.match(endTag); // 匹配结尾标签\n      if (endTagMatch) { // 如果是结尾标签，则删除\n        advance(endTagMatch[0].length);\n        end(endTagMatch[1]);\n      }\n    }\n    let text;\n    if (textEnd > 0) { // 获取标签内的文本\n      text = html.substring(0, textEnd);\n      chars(text);\n    }\n    if (text) { // 如果文本存在，删除文本\n      advance(text.length);\n    }\n  }\n\n  function parseStartTag () {\n    let start = html.match(startTagOpen); // 如果匹配到就是开始标签\n    if (start) {\n      let match = {\n        tagName: start[1], // 标签名\n        attrs: [] // 属性\n      };\n      advance(start[0].length);\n      let end, attr;\n      // 解析属性，如果不是 > 结束标签，且有属性，则匹配\n      while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\n        match.attrs.push({\n          name: attr[1],\n          value: attr[3] || attr[4] || attr[5]\n        }); // 将标签和属性保存起来\n        advance(attr[0].length); // 将属性去掉\n      }\n      if (end) {\n        // 去掉结束的 >\n        advance(end[0].length);\n      }\n      return match;\n    }\n  }\n\n  // 删除匹配到的结果，不断向前走\n  function advance(n) {\n    html = html.substring(n);\n  }\n\n  function start (tagName, attrs) {\n    // 开始标签，创建一个AST元素\n    let element = createAstElement(tagName, attrs);\n    if (!root) { // 第一次没有root，就生成一个根节点\n      root = element;\n    }\n    currentParent = element; // 把点前元素标记成ast树\n    stack.push(element); // 将当前标签存放到栈中\n  }\n\n  function chars(text) {\n    text = text.trim();\n    // 文本节点\n    if (text) {\n      currentParent.children.push({\n        text,\n        type: TEXT_TYPE\n      });\n    }\n  }\n\n  function end(tagName) {\n    // 结束标签\n    let element = stack.pop();\n    // 判断标签是否已经闭合，此处暂未考虑自闭合的标签\n    if (element.tag !== tagName) {\n      throw new TypeError('标签未闭合');\n    }\n    // 我要标识当前这个元素是属于父元素的\n    currentParent = stack[stack.length - 1];\n    if (currentParent) {\n      element.parent = currentParent;\n      currentParent.children.push(element); // 实现了一个树的父子关系\n    }\n  }\n\n  function createAstElement(tagName, attrs) {\n    // 基本的树结构\n    return {\n      tag: tagName,\n      type: ELEMENT_TYPE,\n      children: [],\n      attrs,\n      parent: null\n    };\n  }\n\n  return root;\n}","const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\n\nexport function generage (el) {\n  // 获取孩子节点\n  const children = genChildren(el.children);\n  let code = `_c(\"${el.tag}\", ${genProps(el.attrs)}${children ? `,${children}` : ''})`\n  return code;\n}\n\n// 处理成属性，拼接成字符串\nfunction genProps(attrs) {\n  // console.log(attrs)\n  if (!attrs.length) { // 如果没有属性就返回undefined\n    return undefined;\n  }\n  let str = '';\n  for (let i = 0; i < attrs.length; i++) {\n    let attr = attrs[i];\n    if (attr.name === 'style') { // 拼接style\n      // style=\"color: red\" => {style: {color: 'red'}}\n      let obj = {};\n      attr.value.split(';').forEach(item => {\n        let [key, value] = item.split(':');\n        obj[key] = value;\n      });\n      attr.value = obj;\n    }\n    str += `${attr.name}: ${JSON.stringify(attr.value)},`;\n  }\n  return `{${str.slice(0, -1)}}`;\n}\n\n// 处理孩子节点\nfunction genChildren (children) {\n  if (children && children.length > 0) {\n    // 拿到所有的孩子\n    return `${children.map(c => gen(c)).join(',')}`\n  } else {\n    return false;\n  }\n}\n\nfunction gen (node) {\n  if (node.type === 1) { // 元素标签\n    return generage(node);\n  } else { // 文本\n    let text = node.text;\n    // 还需要将里面的变量拿出来处理\n    // a {{name}} b {{age}} c  => _v(\"a\" + _s(name) + \"b\" + _s(age) + \"c\");\n    let tockens = [];\n    let match, index;\n    // 每次匹配的偏移量\n    let lastIndex = defaultTagRE.lastIndex = 0;\n    // 循环匹配大括号内的变量\n    while (match = defaultTagRE.exec(text)) {\n      index = match.index;\n      // 将第一个文本放进去\n      if (index > lastIndex) {\n        // 给文本加上双引号，后面解析的时候代表是一个字符串\n        tockens.push(JSON.stringify(text.slice(lastIndex, index)));\n      }\n      // 变量取出后用 _s 包裹\n      tockens.push(`_s(${match[1].trim()})`);\n      // 设置偏移量，下次匹配从此处开始\n      lastIndex = index + match[0].length;\n    }\n    // 将最后一个文本放进去\n    if (lastIndex < text.length) {\n      tockens.push(JSON.stringify(text.slice(lastIndex)));\n    }\n    return `_v(${tockens.join('+')})`;\n  }\n}","import { parseHTML } from './html-parser';\nimport { generage } from './codegen';\n\n/* \n  ast 语法树 -> 用对象来描述原生的语法\n  虚拟DOM -> 用对象来描述DOM节点\n */\nexport function compileToFunction(template) {\n  // 解析HTML字符串，变成AST语法树\n  const ast = parseHTML(template);\n  // 需要将AST树转为render函数，其实就是字符串拼接\n  // 核心思路就是，将模板转换为一下的字符串\n  // <div id=\"app\"><p>hello {{ name }}</p>{{ age }}</div>\n  // 将AST转为js方法\n  // _c('div', {id: app}, _c('p', undefined, _v('hello' + _s(name))), _s(age))\n  // console.log(ast);\n  let code = generage(ast);\n  // console.log(code);\n  // 所有的模板引擎实现，都需要用new Fucntion() 和 with\n  let renderFn = new Function(`with(this){return ${code}}`);\n  console.log(renderFn);\n  return function render() {}\n}\n\n/* \n  <div id=\"app\">\n    <p>test</p>\n  </div>\n\n  AST语法树, 用一种抽象的语法来描述原生的HTML结构\n  let root = {\n    tag: 'div',\n    attrs: [{name: 'id', value: 'app'}],\n    type: 1,\n    children: [{\n      tag: 'p',\n      attrs: [],\n      type: 1,\n      children: [{\n        type: 3,\n        text: 'test'\n      }]\n    }]\n  }\n */","import { initState } from './state';\nimport { compileToFunction } from './compiler/index';\n// 在原型上添加一个init方法\nexport function initMixin (Vue) {\n  // 初始化流程\n  Vue.prototype._init = function(options) {\n    // 数据的劫持\n    const vm = this;\n    // vue 中使用 this.$options 指代的就是用户传递的属性\n    vm.$options = options;\n\n    // 初始化转态\n    initState(vm); // 分割代码\n\n    // 如果用户传入了el属性，需要将页面渲染出来\n    // 如果用户传入了el，就要实现挂载的流程\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el);\n    }\n  }\n\n  Vue.prototype.$mount = function(el) {\n    const vm = this;\n    const options = vm.$options;\n    el = document.querySelector(el);\n\n    // 默认会先查找render，没有就会采用 template,在没有就用html\n    if (!options.render) {\n      // 对模板进行编译\n      let template = options.template;\n      if (!template && el) { // 使用的html\n        template = getOuterHTML(el); // 拿到所有的DOM文档\n      }\n      // 我们需要将template转换为render方法\n      const render = compileToFunction(template);\n      options.render = render;\n    }\n  }\n}\n\nfunction getOuterHTML (el) { // 获取html元素\n  if (el.outerHTML) { // outerHTML 在IE中不兼容\n    return el.outerHTML\n  } else {\n    const container = document.createElement('div')\n    container.appendChild(el.cloneNode(true))\n    return container.innerHTML\n  }\n}","// Vue核心代码\nimport { initMixin } from './init'\nfunction Vue(options) {\n  // 进行Vue的初始化操作\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;"],"names":["isObject","obj","def","key","val","enumerable","Object","defineProperty","value","writable","configurable","arrayProto","Array","prototype","arrayMethods","create","methodsToPatch","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observerArray","Observer","isArray","__proto__","walk","keys","i","length","defineReactive","items","observe","get","set","newValue","console","log","initState","vm","opts","$options","props","methods","data","initData","computed","watch","proxy","source","_data","call","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","root","stack","currentParent","ELEMENT_TYPE","TEXT_TYPE","textEnd","indexOf","startTagMatch","parseStartTag","start","tagName","attrs","endTagMatch","match","advance","end","text","substring","chars","attr","push","name","n","element","createAstElement","trim","children","type","pop","tag","TypeError","parent","defaultTagRE","generage","el","genChildren","code","genProps","undefined","str","split","item","JSON","stringify","map","c","gen","join","node","tockens","index","lastIndex","exec","compileToFunction","template","ast","renderFn","Function","render","initMixin","Vue","_init","options","$mount","document","querySelector","getOuterHTML","outerHTML","container","createElement","appendChild","cloneNode","innerHTML"],"mappings":"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"}