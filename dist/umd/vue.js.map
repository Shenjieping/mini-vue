{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["/**\n * @param {any} obj 需要判断的对象\n * @returns {boolean}\n */\nexport function isObject(obj) {\n  return obj && typeof obj === 'object';\n}\n\n/**\n * 给某个对象设置私有属性\n * @param {Object} obj 需要添加的对象\n * @param {string} key 属性\n * @param {any} val 值\n * @param {boolean} enumerable 是否可枚举\n */\nexport function def (obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: true,\n    configurable: true\n  })\n}","/* \n  我们要对数组的 7 个方法进行重写：\n    push, pop, shift, unshift, reverse, sort, splice\n  因为这7个方法会改变原数组\n */\n\nconst arrayProto = Array.prototype;\n// 原型链查找，会向上查找，先查找我们重写的，如果没有再向上查找原型链上的\nexport const arrayMethods = Object.create(arrayProto); // 拷贝原型上的方法，防止我们的代码破坏了原型链\n\nconst methodsToPatch = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n];\n\nmethodsToPatch.forEach(method => {\n  arrayMethods[method] = function(...args) {\n    // 调用我们的方法后。又去调用了原生的方法\n    const result = arrayProto[method].apply(this, args);\n    let ob = this.__ob__; // 将实例上的方法传过来\n    // push shift splice 添加的值可能还是一个对象\n    let inserted; // 保存当前用户插入的元素\n    switch (method) {\n      case 'push':\n      case 'shift':\n        inserted = args;\n        break;\n      case 'splice':\n        // splice有3个属性，只有最后一个属性才是新增的值\n        inserted = args.slice(2);\n        break;\n    }\n    if (inserted) {\n      // 将新增的属性继续观察\n      ob.observerArray(inserted);\n    }\n    return result;\n  }\n});\n","import { isObject, def } from \"../util/index\";\nimport { arrayMethods } from './array';\n\nclass Observer {\n  constructor(value) {\n    this.value = value;\n    // 给当前值，添加一个不可枚举的私有属性，并于传值\n    def(value, '__ob__', this); // 这里如果不设置为不可枚举的值，会导致死循环\n    if (Array.isArray(value)) {\n      // 如果是数组的话。并不会对索引进行观察。因为会导致性能问题\n      // 如果数组里放的是对象。我再对里面的对象进行监控\n      this.observerArray(value);\n      // 我们还需要对 push pop shift unshift splice reverse sort 进行重写\n      value.__proto__ = arrayMethods;\n      /* \n        源码这里做了一个兼容处理，因为IE老浏览器是不支持 __proto__ 设置原型链\n        咋们这里为了简化，不做处理\n       */\n    } else {\n      // 如果是对象，则进行下一步\n      this.walk(value);\n    }\n  }\n  walk(obj) {\n    let keys = Object.keys(obj);\n    // 循环每一个key，添加get/set\n    for (let i = 0; i < keys.length; i++) {\n      let key = keys[i];\n      let value = obj[key];\n      defineReactive(obj, key, value); // 定义响应式数据\n    }\n  }\n  observerArray (items) {\n    for (let i = 0; i < items.length; i++) {\n      observe(items[i]);\n    }\n  }\n}\n\nexport function defineReactive(obj, key, value) {\n  // 递归设置嵌套的对象\n  observe(value);\n  Object.defineProperty(obj, key, {\n    get() {\n      return value;\n    },\n    set(newValue) { // 设置值的时候做一些操作\n      if (value === newValue) {\n        return;\n      }\n      console.log('update 视图更新');\n      observe(newValue); // 如果新设置的值是一个对象，也要被监控\n      value = newValue;\n    }\n  });\n\n  /* \n    通过Vue源码可以看出，data还可以设置 get/set属性\n      如果设置了get，需要先执行函数，拿到返回值再进行处理。为了简化，这里不做这一层的处理\n   */\n}\n\n// 用于观测数据，给每个属性添加 get 和 set 方法\nexport function observe(value) {\n  if (!isObject(value)) {\n    return;\n  }\n  return new Observer(value);\n}","import { observe } from \"./observer/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  // Vue 的数据来源\n  if (opts.props) {\n    initProps(vm);\n  }\n  if (opts.methods) {\n    initMethods(vm);\n  }\n  if (opts.data) {\n    initData(vm);\n  }\n  if (opts.computed) {\n    initComputed(vm);\n  }\n  if (opts.watch) {\n    initWatch(vm);\n  }\n}\n\nfunction initProps(vm) {\n  \n}\nfunction initMethods(vm) {\n  \n}\nfunction initData(vm) {\n  // 数据初始化\n  let data = vm.$options.data;\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data;\n  // 对象劫持，用户改变了数据，我希望能检测到，从而更新页面\n  // MVVM 数据变化可以驱动视图\n\n  // 通过Object.defineProperty 给属性增加get和set方法\n  observe(data); // 响应式原理\n}\nfunction initComputed(vm) {\n  \n}\nfunction initWatch(vm) {\n  \n}","import { initState } from './state';\n// 在原型上添加一个init方法\nexport function initMixin (Vue) {\n  // 初始化流程\n  Vue.prototype._init = function(options) {\n    // 数据的劫持\n    const vm = this;\n    // vue 中使用 this.$options 指代的就是用户传递的属性\n    vm.$options = options;\n\n    // 初始化转态\n    initState(vm); // 分割代码\n  }\n}","// Vue核心代码\nimport { initMixin } from './init'\nfunction Vue(options) {\n  // 进行Vue的初始化操作\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;"],"names":["isObject","obj","def","key","val","enumerable","Object","defineProperty","value","writable","configurable","arrayProto","Array","prototype","arrayMethods","create","methodsToPatch","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observerArray","Observer","isArray","__proto__","walk","keys","i","length","defineReactive","items","observe","get","set","newValue","console","log","initState","vm","opts","$options","props","methods","data","initData","computed","watch","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}